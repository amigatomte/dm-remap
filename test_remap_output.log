[2025-10-17 21:12:50.219233413] =========================================
[2025-10-17 21:12:50.224436046] DM-REMAP METADATA TEST WITH REMAPS
[2025-10-17 21:12:50.228042175] =========================================
[2025-10-17 21:12:50.231941903] STEP 1: Loading modules...
[2025-10-17 21:12:50.325295181] STEP 1: Modules loaded
[2025-10-17 21:12:50.331912591] STEP 2: Creating test images...
[2025-10-17 21:12:50.405399211] STEP 2: Images created
[2025-10-17 21:12:50.408833916] STEP 3: Setting up loop devices...
[2025-10-17 21:12:50.432202666] STEP 3: Loop devices: main=/dev/loop17, spare=/dev/loop20
[2025-10-17 21:12:50.448933662] STEP 4: Sectors=204800
[2025-10-17 21:12:50.453457921] STEP 5: Creating dm-linear for main...
[2025-10-17 21:12:50.479646887] STEP 5: dm-linear-main created
[2025-10-17 21:12:50.483840753] STEP 6: Creating dm-error to inject errors...
[2025-10-17 21:12:50.512962718] STEP 6: dm-error-spare created with errors at sectors 100-109
[2025-10-17 21:12:50.527798093] STEP 7: Creating dm-remap device...
device-mapper: reload ioctl on testdev (252:2) failed: No space left on device
Command failed.
[2025-10-17 21:12:50.542571411] CLEANUP: Starting cleanup...
[2025-10-17 21:12:50.662052202] CLEANUP: Complete
[2025-10-17 21:13:12.436239308] =========================================
[2025-10-17 21:13:12.514672634] DM-REMAP METADATA TEST WITH REMAPS
[2025-10-17 21:13:12.518668855] =========================================
[2025-10-17 21:13:12.522082740] STEP 1: Loading modules...
[2025-10-17 21:13:12.604631564] STEP 1: Modules loaded
[2025-10-17 21:13:12.610134678] STEP 2: Creating test images...
[2025-10-17 21:13:12.674812745] STEP 2: Images created
[2025-10-17 21:13:12.678461096] STEP 3: Setting up loop devices...
[2025-10-17 21:13:12.696559754] STEP 3: Loop devices: main=/dev/loop20, spare=/dev/loop21
[2025-10-17 21:13:12.710969055] STEP 4: Sectors=204800
[2025-10-17 21:13:12.715239637] STEP 5: Creating dm-linear for main...
[2025-10-17 21:13:12.739280614] STEP 5: dm-linear-main created
[2025-10-17 21:13:12.743343922] STEP 6: Creating dm-error to inject errors...
[2025-10-17 21:13:12.767551444] STEP 6: dm-error-spare created with errors at sectors 100-109
[2025-10-17 21:13:12.778327735] STEP 7: Creating dm-remap device...
[2025-10-17 21:13:12.803464773] STEP 7: dm-remap device created
[2025-10-17 21:13:12.808391983] STEP 8: Initial device status:
0 204800 dm-remap-v4 v4.0-phase1.4 /dev/mapper/dm-linear-main /dev/mapper/dm-error-spare 49 0 0 0 0 49 13717 279 829736334405 512 0 49 49 0 0 1 48 1 0 0 100 0 2 operational real
[2025-10-17 21:13:12.819783982] STEP 9: Writing to sectors that will cause errors (100-109)...
1+0 records in
1+0 records out
512 bytes copied, 0,000174963 s, 2,9 MB/s
[2025-10-17 21:13:12.830683025] STEP 9: Write attempt completed
[2025-10-17 21:13:14.836702687] STEP 10: Checking for remaps...
0 204800 dm-remap-v4 v4.0-phase1.4 /dev/mapper/dm-linear-main /dev/mapper/dm-error-spare 98 1 0 0 0 99 36620 369 829736334405 512 0 99 99 0 0 2 97 2 0 0 100 0 2 operational real
[2025-10-17 21:13:14.850269709] STEP 11: Kernel messages:
[  362.489103] dm-remap v4.0 real: Creating real device target: main=/dev/mapper/dm-linear-main, spare=/dev/mapper/dm-error-spare
[  362.489122] dm-remap v4.0 real: Optimized spare sizing calculation:
[  362.489123] dm-remap v4.0 real:   Main device: 204800 sectors (100 MB)
[  362.489125] dm-remap v4.0 real:   Expected bad sectors (2%): 4096 sectors (2 MB)
[  362.489127] dm-remap v4.0 real:   Metadata overhead: 522 sectors (261 KB)
[  362.489128] dm-remap v4.0 real:   Minimum spare (with 20% safety margin): 5541 sectors (2 MB)
[  362.489129] dm-remap v4.0 real: Consider RAID1 mirroring: 100 MB spare for 100 MB main (100%)
[  362.489131] dm-remap v4.0 real: Enhanced device compatibility validated:
[  362.489132] dm-remap v4.0 real:   Main: 204800 sectors, 104857600 bytes (512/512 sector size)
[  362.489133] dm-remap v4.0 real:   Spare: 204800 sectors, 104857600 bytes (512/512 sector size)
[  362.489135] dm-remap v4.0 real:   Overhead available: 0 sectors (0% of main size)
[  362.489139] dm-remap v4.0 real: Real devices opened with enhanced detection:
[  362.489140] dm-remap v4.0 real:   Main: dm-0 (204800 sectors, 512 byte sectors)
[  362.489142] dm-remap v4.0 real:   Spare: dm-1 (204800 sectors, 512 byte sectors)
[  362.489331] dm-remap-v4: Initialized v4.0 metadata: main=, spare=
[  362.489334] dm-remap v4.0 real: Initialized persistent v4 metadata
[  362.489335] dm-remap v4.0 real: Metadata reading deferred (avoiding constructor deadlock)
[  362.489337] dm-remap v4.0 real: Real device target created successfully (real device mode)
[2025-10-17 21:13:14.862453632] STEP 12: Removing device (triggers metadata write)...
[2025-10-17 21:13:14.898240210] STEP 12: Device removed
[2025-10-17 21:13:14.903737092] STEP 13: Checking for metadata write...
[  362.489127] dm-remap v4.0 real:   Metadata overhead: 522 sectors (261 KB)
[  362.489331] dm-remap-v4: Initialized v4.0 metadata: main=, spare=
[  362.489334] dm-remap v4.0 real: Initialized persistent v4 metadata
[  362.489335] dm-remap v4.0 real: Metadata reading deferred (avoiding constructor deadlock)
[2025-10-17 21:13:14.916103192] STEP 14: Checking spare device for metadata...
First 256 bytes of spare device:
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
06400000
[2025-10-17 21:13:14.995085380] =========================================
[2025-10-17 21:13:14.999048308] TEST COMPLETED
[2025-10-17 21:13:15.002534059] =========================================
[2025-10-17 21:13:15.006092759] Check test_remap_output.log for full log
[2025-10-17 21:13:15.009626541] CLEANUP: Starting cleanup...
[2025-10-17 21:13:15.136718247] CLEANUP: Complete
